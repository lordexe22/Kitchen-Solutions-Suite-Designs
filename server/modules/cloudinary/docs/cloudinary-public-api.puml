@startuml cloudinary-public-api

title Cloudinary Module - Public API
note right
  **Audiencia**: Consumers del módulo
  **Objetivo**: Mapa mental de qué ofrece el módulo
  **Actualizado**: 2026-02-06
end note

package "Cloudinary Public API" {
  component "createImage" as createImage
  component "deleteImage" as deleteImage
  component "replaceImage" as replaceImage
  component "renameImage" as renameImage
  component "moveImage" as moveImage
  component "changeImagePrefix" as changeImagePrefix
  component "getImage" as getImage
  component "listImages" as listImages
}

note right of createImage
  **Inputs**:
  - ImageSource (url | file | buffer)
  - CreateImageOptions (name, folder, prefix)
  - ImageMetadata (optional)
  
  **Output**: CreateImageResponse
  **Errores**: ValidationError | UploadError
end note

note right of deleteImage
  **Input**: publicId: string
  **Output**: DeleteImageResponse
  **Errores**: ValidationError | NotFoundError | DeleteError
end note

note right of replaceImage
  **Input**: ReplaceImageParams
  **Output**: ReplaceImageResponse
  **Errores**: ValidationError | NotFoundError | ReplaceImageError
end note

note right of renameImage
  **Input**: RenameImageParams (publicId, newName)
  **Output**: GetImageResult
  **Garantía**: Metadata preservada
  **Errores**: ValidationError | NotFoundError | RenameImageError (409)
end note

note right of moveImage
  **Input**: MoveImageParams (publicId, targetPublicId)
  **Output**: GetImageResult
  **Garantía**: Metadata preservada
  **Errores**: ValidationError | NotFoundError | MoveImageError (409)
end note

note right of changeImagePrefix
  **Input**: ChangeImagePrefixParams (publicId, prefix, mode)
  **Output**: GetImageResult
  **Modes**: replace | append | prepend
  **Garantía**: Delega en renameImage
  **Errores**: ValidationError | NotFoundError | RenameImageError
end note

note right of getImage
  **Input**: publicId: string
  **Output**: GetImageResult
  **Garantía**: Resultado normalizado
  **Errores**: ValidationError | NotFoundError | FetchImageError
end note

note right of listImages
  **Input**: ListImagesParams (folder, recursive, limit, cursor)
  **Output**: ListImagesResult
  **Garantía**: Limit respetado (1-100)
  **Errores**: ValidationError | FetchImageError
  **Nota**: 404 retorna array vacío
end note

changeImagePrefix ..> renameImage : delegates
renameImage ..> getImage : source of truth
moveImage ..> getImage : source of truth

note as N1
  **Principios comunes**:
  - Todos retornan objetos normalizados
  - Cloudinary es source of truth
  - Context metadata siempre preservado
  - Errores específicos por operación
end note

@enduml
